var x=Object.defineProperty;var g=(r,e,t)=>e in r?x(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t;var h=(r,e,t)=>(g(r,typeof e!="symbol"?e+"":e,t),t);import{r as d,j as a,R as M}from"./index-d519f09c.js";import{P as m}from"./pos-bbfa6582.js";class p extends m{constructor(t,i,s,n,l,c,o){super(t,i);h(this,"color");h(this,"isShow");h(this,"isMarked");h(this,"value");h(this,"isClickError");this.isShow=n,this.color=s,this.isMarked=l,this.value=c,this.isClickError=o}static mine(t,i,s="ðŸ’£",n=!1,l=!1,c=-1,o=!1){return new p(t,i,s,n,l,c,o)}static grass(t,i,s=null,n=!1,l=!1,c=0,o=!1){return new p(t,i,s,n,l,c,o)}isMine(){return this.value<0}mark(){const{isShow:t}=this;t||(this.isMarked=!this.isMarked)}toMine(){this.color="ðŸ’£",this.value=-1}setValue(t){this.value=t,this.isShow=!0}toView(){const{isShow:t,color:i,value:s,isMarked:n}=this;return n?"ðŸš©":t?this.isMine()?i:s||null:null}isMarkError(){const{isMarked:t}=this;return t&&!this.isMine()}}class w{constructor(e,t,i,s,n){h(this,"width");h(this,"height");h(this,"isFailed");h(this,"mineCount");h(this,"positions");this.width=e,this.height=t,this.isFailed=i,this.mineCount=s,this.positions=n}static default(e=16,t=30,i=20){let s=Array(t).fill(0).map((l,c)=>Array(e).fill(0).map((o,u)=>p.grass(u,c))),n=0;for(;n<i;){let l=s[~~(Math.random()*t)][~~(Math.random()*e)];l.isMine()||(l.toMine(),n+=1)}return new w(e,t,!1,i,s)}isMine(e){return this.getPosition(e).isMine()}isInBounds(e){return e.x>=0&&e.x<this.width&&e.y>=0&&e.y<this.height}getPosition(e){return this.positions[e.y][e.x]}iterDirection(){return[0,2,4,6,1,5,3,7]}next(e,t){switch(t){case 0:return e.add(m.new(0,-1));case 1:return e.add(m.new(1,-1));case 2:return e.add(m.new(1,0));case 3:return e.add(m.new(1,1));case 4:return e.add(m.new(0,1));case 5:return e.add(m.new(-1,1));case 6:return e.add(m.new(-1,0));case 7:return e.add(m.new(-1,-1));default:return console.warn("where do you want to go ???",t),e}}scan(e){if(!e.isMarked){if(this.isMine(e)){this.isFailed=!0,e.isClickError=!0,this.positions.forEach(t=>{t.forEach(i=>i.isShow=!0)});return}this.search(e,[])}}search(e,t=[]){let i=[e];const s=this.iterDirection();for(;i.length;){let n=i.shift(),l=0,c=[];for(let o=0;o<s.length;o++){let u=s[o],f=this.next(n,u);this.isInBounds(f)&&(this.getPosition(f).isMarked||(this.isMine(f)?l+=1:c.push(f)))}t.push(n),this.getPosition(n).setValue(l),l<=0&&c.forEach(o=>{i.every(u=>!u.eq(o))&&t.every(u=>!u.eq(o))&&i.push(o)})}}clone(){const{width:e,height:t,isFailed:i,mineCount:s,positions:n}=this;return new w(e,t,i,s,n)}iterPosition(){return this.positions.flatMap(e=>e.map(t=>t))}markedMineCount(){return this.mineCount-this.iterPosition().filter(e=>e.isMarked).length}markMine(e){e.mark()}}const C=M.memo(function({maybeMine:e,handleClick:t}){let{isShow:i,isClickError:s}=e;return a.jsx(a.Fragment,{children:a.jsx("div",{style:{border:"1px solid gray",display:"flex",justifyContent:"center",alignItems:"center",padding:"0.1rem",background:i?s?"red":"white":""},onClick:n=>t(n,e),onAuxClick:n=>t(n,e),children:e.toView()})})},(r,e)=>{if(r.handleClick!==e.handleClick)return!1;const{isShow:t,value:i}=r.maybeMine,{isShow:s,value:n}=e.maybeMine;return t===s&&n===i}),S=M.memo(({mineCount:r})=>a.jsx(a.Fragment,{children:a.jsx("span",{children:r.toString().padStart(3,"0")})})),v=M.memo(({gameStatus:r})=>{const[e,t]=d.useState(0),i=d.useRef(null);return d.useEffect(()=>{if(r==="ðŸ˜µ"){clearInterval(i.current),i.current=null;return}if(i.current===null&&r==="ðŸ˜€"&&t(0),i.current==null)return i.current=setInterval(()=>{t(s=>s+1)},1e3),()=>{}}),a.jsx(a.Fragment,{children:a.jsx("span",{children:e.toString().padStart(3,"0")})})},(r,{gameStatus:e})=>!(e==="ðŸ˜µ"||e==="ðŸ˜€"));function F(){const[r,e]=d.useState(w.default(10,15,20)),[t,i]=d.useState("ðŸ˜€"),s=d.useCallback((u,f)=>{if(u.preventDefault(),!r.isFailed)switch(u.button){case 0:{e(k=>(k.scan(f),k.isFailed&&i("ðŸ˜µ"),k.clone()));return}case 2:r.markMine(f),e(r.clone())}},[r,e]),n=d.useCallback(function(){r.isFailed||i("ðŸ˜²")},[r,t,i]),l=d.useCallback(function(){r.isFailed?i("ðŸ˜µ"):i("ðŸ˜€")},[r,t,i]),c=d.useCallback(()=>{e(w.default(10,15,20)),i("ðŸ˜€")},[e]),o=d.useMemo(()=>a.jsx("div",{style:{cursor:"pointer"},onClick:c,children:t}),[t]);return d.useEffect(()=>{document.oncontextmenu=function(u){u.preventDefault()}},[]),a.jsxs("div",{className:"mineSwepper-view",style:{display:"flex",flexDirection:"column",color:"black"},children:[a.jsxs("div",{className:"mineSweeper-header",style:{display:"flex",justifyContent:"space-between"},children:[a.jsx(S,{mineCount:r.markedMineCount()}),o,a.jsx(v,{gameStatus:t})]}),a.jsx("div",{onMouseDown:n,onMouseUp:l,className:"mineSweeper-container",style:{display:"grid",gridTemplateRows:`repeat(${r.height}, 1rem)`,gridTemplateColumns:`repeat(${r.width}, 1rem)`,background:"#e8e7e7",cursor:"pointer",color:"black"},children:r.iterPosition().map((u,f)=>a.jsx(a.Fragment,{children:a.jsx(C,{maybeMine:u,handleClick:s},`${f}-${u.asKey()}`)}))})]})}export{F as default};
