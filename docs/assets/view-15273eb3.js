var y=Object.defineProperty;var F=(s,e,t)=>e in s?y(s,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):s[e]=t;var h=(s,e,t)=>(F(s,typeof e!="symbol"?e+"":e,t),t);import{r as c,j as p,R as b}from"./index-d519f09c.js";import{P as i}from"./pos-bbfa6582.js";class l extends i{constructor(t,r,o){super(t,r);h(this,"food_color");this.food_color=o}static newFood(t,r,o){return new l(t,r,o)}}var n=(s=>(s[s.Left=0]="Left",s[s.Right=1]="Right",s[s.Up=2]="Up",s[s.Down=3]="Down",s))(n||{}),w=(s=>(s[s.Normal=0]="Normal",s[s.Dead=1]="Dead",s[s.Grow=2]="Grow",s[s.Neck=3]="Neck",s))(w||{});class f{constructor(e,t,r="游린"){h(this,"positions");h(this,"headColor");h(this,"color");this.positions=e,this.headColor=t,this.color=r}static new(e,t="游댮"){return new f(new Set(e),t)}getHead(){return this.iterPositions()[0]}move(e,t){let r;switch(e){case 3:{r=i.new(0,1);break}case 2:{r=i.new(0,-1);break}case 0:{r=i.new(-1,0);break}case 1:{r=i.new(1,0);break}}let o=this.getHead().add(r);if(this.isNeck(o))return 3;if(this.eatSelf(o))return 1;let a=this.iterPositions();return o.eq(t)?(this.positions=new Set([o].concat(a)),2):(a.pop(),this.positions=new Set([o].concat(a)),0)}iterPositions(){return Array.from(this.positions)}eatSelf(e){return!!this.iterPositions().find(t=>t.eq(e))}isNeck(e){return this.iterPositions()[1].eq(e)}}class m{constructor(e,t,r,o,a){h(this,"width");h(this,"height");h(this,"snake");h(this,"food");h(this,"isFailed");this.width=e,this.height=t,this.snake=r,this.food=o,this.isFailed=a}static default(e=30,t=30){return new m(e,t,f.new([l.newFood(e/2,t/2,"游린"),l.newFood(e/2+1,t/2,"游린"),l.newFood(e/2+2,t/2,"游린")]),l.newFood(~~(Math.random()*e),~~(Math.random()*t),["游린","游릶","游릵","游릱","游릴","游릳","游릲"][~~(Math.random()*7)]),!1)}newSnake(){const{width:e,height:t}=this;return f.new([i.new(e/2,t/2),i.new(e/2+1,t/2),i.new(e/2+2,t/2)])}refreshFood(){const{width:e,height:t}=this;let r=()=>l.newFood(~~(Math.random()*e),~~(Math.random()*t),["游린","游릶","游릵","游릱","游릴","游릳","游릲"][~~(Math.random()*7)]),o=r();for(;this.isSnake(o);)o=r();this.food=o}isIndBounds(e){let t;switch(e){case n.Down:{t=i.new(0,1);break}case n.Up:{t=i.new(0,-1);break}case n.Left:{t=i.new(-1,0);break}case n.Right:{t=i.new(1,0);break}}let r=this.snake.getHead().add(t);return r.x>=0&&r.x<this.width&&r.y>=0&&r.y<this.height}tryMove(e){if(this.isFailed)return!1;if(!this.isIndBounds(e))return this.isFailed=!0,!1;switch(this.snake.move(e,this.food)){case w.Grow:return this.refreshFood(),!0;case w.Normal:return!0;case w.Dead:return this.isFailed=!0,!0;case w.Neck:return!1}}clone(){const{width:e,height:t,snake:r,food:o,isFailed:a}=this;return new m(e,t,r,o,a)}isSnake(e){return this.snake.iterPositions().some(t=>t.eq(e))}getPosition(e){const{snake:t,food:r}=this;return r.eq(e)?r.food_color:t.getHead().eq(e)?t.headColor:this.isSnake(e)?t.color:""}}const S=b.memo(({x:s,y:e,colorShape:t})=>p.jsx("div",{style:{display:"flex",alignItems:"center",justifyContent:"center"},children:t},`${s}-${e}`));function P(){const[s,e]=c.useState(m.default(30,30)),[t,r]=c.useState(n.Left),o=c.useRef(null),a=c.useCallback(function(u){let d=!1;switch(u.code){case"ArrowLeft":d=s.tryMove(n.Left),d&&r(n.Left);break;case"ArrowRight":d=s.tryMove(n.Right),d&&r(n.Right);break;case"ArrowUp":d=s.tryMove(n.Up),d&&r(n.Up);break;case"ArrowDown":d=s.tryMove(n.Down),d&&r(n.Down);break}d&&e(s.clone())},[s,e,t,r]);return c.useEffect(()=>(document.addEventListener("keydown",a),()=>{document.removeEventListener("keydown",a)}),[a]),c.useEffect(()=>(o.current=setInterval(()=>{s.tryMove(t),e(s.clone())},500),()=>clearInterval(o.current)),[t,s,e]),p.jsx("div",{className:"container",style:{display:"grid",gridTemplateColumns:`repeat(${s.width}, 1rem)`,gridTemplateRows:`repeat(${s.height}, 1rem)`,width:"fit-content"},children:Array(s.height).fill(null).flatMap((g,u)=>Array(s.width).fill(null).map((d,k)=>p.jsx(S,{x:k,y:u,colorShape:s.getPosition(i.new(k,u))},k+"-"+u)))})}export{P as default};
